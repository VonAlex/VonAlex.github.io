<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="apple-touch-icon" sizes="76x76" href="/images/dolphin.png"><link rel="icon" type="image/png" href="/images/dolphin.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#433d3c"><meta name="description" content=""><meta name="author" content="Happen"><meta name="keywords" content=""><title>Redis Cluster availability è®¨è®º - Happenã®Memo</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/rainbow.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body><header style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Happenã®Memo</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/happencc/pics/raw/master/images/about-banner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Happen </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-02-19 21:58" pubdate>2021-02-19 21:58</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.2k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 17 åˆ†é’Ÿ </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> æ¬¡</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Redis Cluster availability è®¨è®º</h1><p class="note note-info">æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2021-02-19 21:58</p><div class="markdown-body" id="post-body"><p>æœ¬æ–‡æ¡£ä¸»è¦åŸºäºä¸ªäººç†è§£ï¼Œåˆ†æ Redis Cluster è®¾è®¡ä¸­å¯¹äº Availability çš„ä¸€äº›è€ƒé‡ã€‚<br><a id="more"></a><br>å½“ Redis ä»¥ Cluster æ¨¡å¼å¯åŠ¨æ—¶ï¼Œå¯¹äºä¸€ä¸ª master èŠ‚ç‚¹ï¼Œåªæœ‰å½“é›†ç¾¤ä¸º CLUSTER_OK çŠ¶æ€æ—¶ï¼Œæ‰èƒ½æ­£å¸¸æ¥å—è®¿é—®ï¼Œè¿™åœ¨ä¹‹å‰çš„åšå®¢ ã€Š<a href="https://happencc.gitee.io/a9d44741.html">Redis Cluster write safety åˆ†æ</a>ã€‹è®¨è®ºè¿‡ã€‚</p><p>Redis Cluster è®¾è®¡çš„ä¸‰ä¸ªç›®æ ‡ï¼Œæœ€åä¸€ä¸ªæ‰æ˜¯å¯ç”¨æ€§ã€‚</p><blockquote><p>Redis Cluster is able to survive partitions where the majority of the master nodes are reachable and there is at least one reachable slave for every master node that is no longer reachable. Moreover using replicas migration, masters no longer replicated by any slave will receive one from a master which is covered by multiple slaves.</p></blockquote><p>ä¸‹é¢ä¸»è¦è®¨è®ºä¸‰ç§æƒ…å†µã€‚</p><h3 id="partition- æ•…éšœ"><a href="#partition- æ•…éšœ" class="headerlink" title="partition æ•…éšœ"></a>partition æ•…éšœ</h3><p>Redis Cluster åœ¨å‘ç”Ÿ partition åï¼Œminority éƒ¨åˆ†æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p>å‡è®¾ majority éƒ¨åˆ†æœ‰è¿‡åŠæ•° master åŠæ¯ä¸ª unreachable master çš„ä¸€ä¸ª slaveã€‚é‚£ä¹ˆï¼Œç»è¿‡ NODE_TIMEOUT æ—¶é—´åŠ é¢å¤–å‡ ç§’é’Ÿï¼ˆç»™ slave è¿›è¡Œ failoverï¼‰ï¼Œcluster æ¢å¤å¯ç”¨çŠ¶æ€ã€‚</p><p>å½“é›†ç¾¤ä¸­æœ‰è¿‡åŠæ•° master å¯è¾¾ï¼Œcluster å°±ä¸ä¼šæ ‡è®°æˆ <strong>CLUSTER_FAIL</strong>ã€‚</p><h3 id="replicas-migration- åŠŸèƒ½"><a href="#replicas-migration- åŠŸèƒ½" class="headerlink" title="replicas migration åŠŸèƒ½"></a>replicas migration åŠŸèƒ½</h3><p>Redis Cluster çš„è®¾è®¡ï¼Œä¿è¯äº†å°‘æ•°èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä¾ç„¶å¯ç”¨ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŒ…å« N ä¸ª master çš„é›†ç¾¤ï¼Œæ¯ä¸ª master æœ‰å”¯ä¸€ slaveã€‚<br>å•ä¸ª node å‡ºç°æ•…éšœï¼Œcluster ä»ç„¶å¯ç”¨ï¼Œç¬¬äºŒä¸ª node å†å‡ºç°æ•…éšœï¼Œé›†ç¾¤ä»ç„¶å¯ç”¨çš„æ¦‚ç‡æ˜¯ 1-(1/(N*2-1)ã€‚</p><div class="note note-info"><p>è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼Œ</p><p>ç¬¬ä¸€ä¸ª node fail åï¼Œé›†ç¾¤å‰©ä¸‹ N*2-1 ä¸ªå¥åº·èŠ‚ç‚¹ï¼Œæ­¤æ—¶ orphan master æ°å¥½ fail çš„æ¦‚ç‡æ˜¯ 1/(N*2-1)ã€‚</p></div><p>å¥—ç”¨å…¬å¼ï¼Œå‡è®¾ N = 5ï¼Œé‚£ä¹ˆï¼Œ2 ä¸ªèŠ‚ç‚¹ä» majority partition å‡ºå»ï¼Œé›†ç¾¤ä¸å¯ç”¨çš„æ¦‚ç‡æ˜¯ 11.11%ã€‚</p><p>redis ä¸ºäº†æé«˜é›†ç¾¤å¯ç”¨æ€§ï¼Œæä¾›äº† <strong>replicas migration</strong> åŠŸèƒ½ï¼Œä»£ç åˆ†æå¦‚ä¸‹ï¼Œ</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clusterCron</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;
    <span class="hljs-keyword">int</span> orphaned_masters;
    <span class="hljs-keyword">int</span> max_slaves;
    <span class="hljs-keyword">int</span> this_slaves;
    ... 
    di = dictGetSafeIterator(server.cluster-&gt;nodes);
    <span class="hljs-keyword">while</span>((de = dictNext(di)) != <span class="hljs-literal">NULL</span>) &#123;
    	clusterNode *node = dictGetVal(de);
        ...
        <span class="hljs-keyword">if</span> (nodeIsSlave(myself) &amp;&amp; 
            nodeIsMaster(node) &amp;&amp; 
            !nodeFailed(node)) &#123;
            <span class="hljs-comment">// ç»Ÿè®¡ node æœ‰å‡ ä¸ªå¥åº·çš„ slave</span>
            <span class="hljs-keyword">int</span> okslaves = clusterCountNonFailingSlaves(node);
            <span class="hljs-comment">// æ²¡æœ‰ slave ä½†ä¾ç„¶è´Ÿè´£ slot çš„ master</span>
            <span class="hljs-keyword">if</span> (okslaves == <span class="hljs-number">0</span> &amp;&amp; 
                node-&gt;numslots &gt; <span class="hljs-number">0</span> &amp;&amp; 
                node-&gt;flags &amp; CLUSTER_NODE_MIGRATE_TO)
            &#123;
                orphaned_masters++;
            &#125;
            <span class="hljs-keyword">if</span> (okslaves &gt; max_slaves) max_slaves = okslaves;
            <span class="hljs-comment">// node æ˜¯æˆ‘çš„ master</span>
            <span class="hljs-keyword">if</span> (nodeIsSlave(myself) &amp;&amp; myself-&gt;slaveof == node)
                this_slaves = okslaves;
        &#125;
    &#125;
    ...
    <span class="hljs-keyword">if</span> (nodeIsSlave(myself)) &#123;
        ...
       	<span class="hljs-keyword">if</span> (orphaned_masters &amp;&amp; max_slaves &gt;= <span class="hljs-number">2</span> &amp;&amp; this_slaves == max_slaves)
            clusterHandleSlaveMigration(max_slaves);
    &#125;
    ...
&#125;</code></pre></div><p>é¦–å…ˆå®šä¹‰äº†ä»€ä¹ˆæ ·çš„èŠ‚ç‚¹ç®— orphaned masterï¼Œå³ï¼Œè´Ÿè´£éƒ¨åˆ† slot ä½†æ²¡æœ‰å¥åº· slave çš„ masterã€‚orphaned master æœ‰å¯ç”¨æ€§é£é™©ï¼Œä¸€æ—¦æŒ‚æ‰ï¼Œåˆ™æ•´ä¸ª sharding ä¸å¯ç”¨ã€‚</p><p>ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“ slave æ£€æµ‹åˆ°è‡ªå·±çš„ master æ‹¥æœ‰ä¸å°‘äº 2 ä¸ªå¥åº· slave ï¼Œä¸” cluster ä¸­æ°å¥½æœ‰ orphan master æ—¶ï¼Œè§¦å‘ <code>clusterHandleSlaveMigration</code> å‡½æ•°é€»è¾‘ï¼Œå°è¯•è¿›è¡Œ slave æ¼‚ç§»ï¼Œæ¼‚ç§»æ­¥éª¤æœ‰ 4 æ­¥ï¼Œä¸‹é¢è¿›è¡Œåˆ†æ­¥è¯´æ˜ã€‚</p><p>ï¼ˆ1ï¼‰CLUSTER_FAIL é›†ç¾¤æ¼‚ç§»ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (server.cluster-&gt;state != CLUSTER_OK) <span class="hljs-keyword">return</span>;</code></pre></div><p>é CLUSTER_OK é›†ç¾¤æœ¬æ¥å°±æ— æ³•æ­£å¸¸æ¥å—è¯·æ±‚ï¼Œæ¼‚ç§»å¤šæ­¤ä¸€ä¸¾ï¼Œå¿½ç•¥æ‰è¿™ç§æƒ…å†µã€‚</p><p>ï¼ˆ2ï¼‰æ£€æŸ¥ cluster-migration-barrier å‚æ•°ã€‚</p><p><strong>redis conf æä¾›äº† cluster-migration-barrier å‚æ•°</strong>ï¼Œç”¨æ¥å†³å®š slave æ•°é‡è¾¾åˆ°å¤šå°‘ä¸ªæ‰ä¼šæŠŠå†—ä½™ slave æ¼‚ç§»å‡ºå»ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; mymaster-&gt;numslaves; j++)
    <span class="hljs-keyword">if</span> (!nodeFailed(mymaster-&gt;slaves[j]) &amp;&amp;
        !nodeTimedOut(mymaster-&gt;slaves[j])) okslaves++;
<span class="hljs-keyword">if</span> (okslaves &lt;= server.cluster_migration_barrier) <span class="hljs-keyword">return</span>;</code></pre></div><p>åªæœ‰ mymaster å¥åº· slave çš„ä¸ªæ•°è¶…è¿‡ cluster-migration-barrier é…ç½®çš„æ•°é‡æ—¶ï¼Œæ‰ä¼šæ¼‚ç§»ã€‚</p><p>ï¼ˆ3ï¼‰é€‰å‡ºè¦æ¼‚ç§»çš„ slave ä»¥åŠæ¼‚ç»™è°ã€‚</p><div class="hljs"><pre><code class="hljs c">candidate = myself;
di = dictGetSafeIterator(server.cluster-&gt;nodes);
<span class="hljs-keyword">while</span>((de = dictNext(di)) != <span class="hljs-literal">NULL</span>) &#123;
    clusterNode *node = dictGetVal(de);
    <span class="hljs-keyword">int</span> okslaves = <span class="hljs-number">0</span>, is_orphaned = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">if</span> (nodeIsSlave(node) || nodeFailed(node)) is_orphaned = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (!(node-&gt;flags &amp; CLUSTER_NODE_MIGRATE_TO)) is_orphaned = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (nodeIsMaster(node)) okslaves = clusterCountNonFailingSlaves(node);
    <span class="hljs-keyword">if</span> (okslaves &gt; <span class="hljs-number">0</span>) is_orphaned = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">if</span> (is_orphaned) &#123;
        <span class="hljs-keyword">if</span> (!target &amp;&amp; node-&gt;numslots &gt; <span class="hljs-number">0</span>) target = node;
        <span class="hljs-keyword">if</span> (!node-&gt;orphaned_time) node-&gt;orphaned_time = mstime();
    &#125; <span class="hljs-keyword">else</span> &#123;
        node-&gt;orphaned_time = <span class="hljs-number">0</span>;
    &#125;

    <span class="hljs-keyword">if</span> (okslaves == max_slaves) &#123;
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; node-&gt;numslaves; j++) &#123;
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(node-&gt;slaves[j]-&gt;name,
                       candidate-&gt;name,
                       CLUSTER_NAMELEN) &lt; <span class="hljs-number">0</span>)
            &#123;
                candidate = node-&gt;slaves[j];
            &#125;
        &#125;
    &#125;
&#125;
dictReleaseIterator(di);</code></pre></div><p>é€‰æ‹© node name æœ€å°çš„ slave ï¼Œæ¼‚ç§»ç»™éå†åˆ°çš„ç¬¬ä¸€ä¸ª orphaned masterï¼Œå¦‚æœæœ‰å¤šä¸ªã€‚</p><p>ï¼ˆ4ï¼‰æ‰§è¡Œæ¼‚ç§»ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CLUSTER_SLAVE_MIGRATION_DELAY 5000 </span>
<span class="hljs-keyword">if</span> (target &amp;&amp; candidate == myself &amp;&amp;
    (mstime()-target-&gt;orphaned_time) &gt; CLUSTER_SLAVE_MIGRATION_DELAY)
&#123;
    serverLog(LL_WARNING,<span class="hljs-string">&quot;Migrating to orphaned master %.40s&quot;</span>,
              target-&gt;name);
    clusterSetMaster(target);
&#125;</code></pre></div><p>åœ¨ failover æœŸé—´ï¼Œmaster æœ‰ä¸€æ®µæ—¶é—´æ˜¯æ²¡æœ‰ slave çš„ï¼Œä¸ºé˜²æ­¢è¯¯æ¼‚ï¼Œæ¼‚ç§»å¿…é¡»æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œæ—¶é—´ä¸º CLUSTER_SLAVE_MIGRATION_DELAYï¼Œç°ç‰ˆæœ¬ä¸º 5sã€‚</p><h3 id="sharding- ç¼ºå¤±æ•…éšœ"><a href="#sharding- ç¼ºå¤±æ•…éšœ" class="headerlink" title="sharding ç¼ºå¤±æ•…éšœ"></a>sharding ç¼ºå¤±æ•…éšœ</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ£€æµ‹åˆ°æœ‰ slot æ²¡æœ‰ç»‘å®šï¼ŒRedis Cluster å°±ä¼šåœæ­¢æ¥æ”¶è¯·æ±‚ã€‚åœ¨è¿™ç§é…ç½®ä¸‹ï¼Œå¦‚æœ cluster éƒ¨åˆ†èŠ‚ç‚¹æŒ‚æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªèŒƒå›´å†…çš„ slot ä¸å†æœ‰èŠ‚ç‚¹è´Ÿè´£ï¼Œæœ€ç»ˆæ•´ä¸ª cluster ä¼šå˜å¾—ä¸èƒ½æä¾›æœåŠ¡ã€‚</p><p><strong>æœ‰æ—¶å€™ï¼ŒæœåŠ¡éƒ¨åˆ†å¯ç”¨æ¯”æ•´ä¸ªä¸å¯ç”¨æ›´æœ‰æ„ä¹‰</strong>ï¼Œå› æ­¤ï¼Œå³ä½¿ä¸€éƒ¨åˆ† sharding å¯ç”¨ï¼Œä¹Ÿè¦è®© cluster æä¾›æœåŠ¡ã€‚redis å°†è¿™ç§é€‰æ‹©æƒäº¤åˆ°äº†ç”¨æˆ·æ‰‹ä¸­ï¼Œconf é‡Œæä¾› <strong>cluster-require-full-coverage</strong> å‚æ•°ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clusterUpdateState</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;
    ...
    <span class="hljs-keyword">if</span> (server.cluster_require_full_coverage) &#123; 
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; CLUSTER_SLOTS; j++) &#123;
            <span class="hljs-keyword">if</span> (server.cluster-&gt;slots[j] == <span class="hljs-literal">NULL</span> ||
                server.cluster-&gt;slots[j]-&gt;flags &amp; (CLUSTER_NODE_FAIL))
            &#123;
                new_state = CLUSTER_FAIL;
                <span class="hljs-keyword">break</span>;
            &#125;
        &#125;
    &#125;
    ...
&#125;</code></pre></div><p>ä»¥ä¸Šä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœé…ç½® cluster-require-full-coverage ä¸º yesï¼Œé‚£ä¹ˆï¼Œæœ‰ slot æœªç»‘å®šæˆ–è€… sharding ç¼ºå¤±ï¼Œä¼šå°† cluster çŠ¶æ€è®¾ç½®ä¸º CLUSTER_FAILï¼Œserver å°±ä¼šæ‹’ç»è¯·æ±‚ã€‚</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97/">æºç ç³»åˆ—</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/redis/">redis</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/cda51ded.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Redis Cluster è·¯ç”±å˜æ›´</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/a9d44741.html"><span class="hidden-mobile">Redis Cluster write safety åˆ†æ</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg1MS8xMzM4Nw"><script type="text/javascript">function loadLivere(){addScript("https://cdn-city.livere.com/js/embed.dist.js")}waitElementVisible("lv-container",loadLivere)</script><noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·å…è®¸ JavaScript è¿è¡Œ</noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="footer-content"><div><span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("04/03/2016 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="ğŸš€ &nbsp"+dnum+"&nbspå¤©",document.getElementById("times").innerHTML=hnum+"&nbspå°æ—¶&nbsp"+mnum+"&nbspåˆ†&nbsp"+snum+"&nbspç§’"}setInterval("createtime()",250)</script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡ </span><span id="busuanzi_container_site_uv" style="display:none">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº</span></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Redis Cluster availability è®¨è®º&nbsp;"],cursorChar:"|",typeSpeed:72,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "Â§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?14630c2a053c5952e46094f24dabb623";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>