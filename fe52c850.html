<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="dstat工具使用"><meta name="keywords" content="shell"><meta name="author" content="Happen"><meta name="copyright" content="Happen"><title>dstat工具使用 | Happen's Memo</title><link rel="shortcut icon" href="/images/dolphin.png"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?882b48640075e00a238ae94a7eec0d40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>!function(e,a,t,n,c,g,o){e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,g=a.createElement(t),o=a.getElementsByTagName(t)[0],g.async=1,g.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(g,o)}(window,document,"script",0,"ga"),ga("create","RRBput3V2WYVZd2lq058Z4IwJEhViOwuMElqkWh6bcA","auto"),ga("send","pageview")</script><script>var GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容:${query}"}},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"}}</script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点"><span class="toc-number">1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">2.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#外部插件"><span class="toc-number">3.</span> <span class="toc-text">外部插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用例"><span class="toc-number">4.</span> <span class="toc-text">用例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用选项"><span class="toc-number">5.</span> <span class="toc-text">常用选项</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/images/avatar.png"></div><div class="author-info__name text-center">Happen</div><div class="author-info__description text-center">浮生若梦，为欢几何</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">37</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">14</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">7</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="http://renrenlove.me/" target="_blank" rel="noopener">Galway</a><a class="author-info-links__name text-center" href="http://kvguru.com/" target="_blank" rel="noopener">Wangbin</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image:url(https://s2.ax1x.com/2019/11/17/Mr5txK.jpg)"><div id="page-header"> <span class="pull-left"><a id="site-name" href="/">Happen's Memo</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i> <span>搜索</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">dstat工具使用</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-04</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/linux/">linux</a><div class="post-meta-wordcount"><span>字数总计:</span> <span class="word-count">1.6k</span><span class="post-meta__separator">|</span><span>阅读时长: 7 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p><strong>Dstat</strong> 是一个多样化的资源统计工具。<a href="http://dag.wiee.rs/home-made/dstat/" target="_blank" rel="noopener">官网</a>上是这么说的，感受一下：</p><blockquote><p>Dstat is a versatile replacement for vmstat, iostat, netstat and ifstat. Dstat overcomes some of their limitations and adds some extra features, more counters and flexibility. Dstat is handy for monitoring systems during performance tuning tests, benchmarks or troubleshooting.<br>Dstat allows you to view all of your system resources in real-time, you can eg. compare disk utilization in combination with interrupts from your IDE controller, or compare the network bandwidth numbers directly with the disk throughput (in the same interval).</p></blockquote><a id="more"></a><p>dstat将以列表的形式为你提供选项信息并清晰地告诉你是在何种幅度和单位显示输出。这样更好地避免了信息混乱和误报。更重要的是，它可以让你更容易编写插件来收集你想要的数据信息，以从未有过的方式进行扩展。</p><p>Dstat的默认输出是专门为人们实时查看而设计的，不过你也可以将详细信息通过CSV输出到一个文件，并导入到Gnumeric或者Excel生成表格中。</p><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>Combines <strong>vmstat</strong>, <strong>iostat</strong>, <strong>ifstat</strong>, <strong>netstat</strong> information and more</li><li>Shows stats in exactly the same timeframe</li><li>Enable/order counters as they make most sense during analysis/troubleshooting</li><li>Modular design</li><li>Written in <strong>python</strong> so easily extendable for the task at hand</li><li>Easy to extend, add your own counters (please contribute those)</li><li>Includes many external plugins to show how easy it is to add counters</li><li>Can summarize grouped block/network devices and give total numbers</li><li>Can show interrupts per device</li><li>Very accurate timeframes, no timeshifts when system is stressed</li><li>Shows exact units and limits conversion mistakes</li><li>Indicate different units with different colors</li><li>Show intermediate results when delay &gt; 1</li><li>Allows to export CSV output, which can be imported in Gnumeric and Excel to make graphs</li></ul><p>以上的特点是从官网扒下来的，可以参考一下。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>centos 可以直接使用如下命令安装：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install dstat</span><br></pre></td></tr></table></figure><h3 id="外部插件"><a href="#外部插件" class="headerlink" title="外部插件"></a>外部插件</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@pandora ~]# dstat --list</span><br><span class="line">internal:</span><br><span class="line">trueaio, cpu, cpu24, disk, disk24, disk24old, epoch, fs, int, int24, io, ipc, load, lock, mem, net, page, page24, proc, raw, socket, swap, swapold, sys, tcp, time, udp, unix, vm</span><br><span class="line">/usr/share/dstat:</span><br><span class="line">truebattery, battery-remain, cpufreq, dbus, disk-util, fan, freespace, gpfs, gpfs-ops, helloworld, innodb-buffer, innodb-io, innodb-ops, lustre, memcache-hits, mysql-io, mysql-keys, mysql5-cmds,</span><br><span class="line">truemysql5-conn, mysql5-io, mysql5-keys, net-packets, nfs3, nfs3-ops, nfsd3, nfsd3-ops, ntp, postfix, power, proc-count, rpc, rpcd, sendmail, snooze, thermal, top-bio, top-cpu, top-cputime, top-cputime-avg,</span><br><span class="line">truetop-io, top-latency, top-latency-avg, top-mem, top-oom, utmp, vm-memctl, vmk-hba, vmk-int, vmk-nic, vz-cpu, vz-io, vz-ubc, wifi</span><br></pre></td></tr></table></figure><p>通过<code>dstat --list</code>可以查看 dstat 能使用的所有参数，其中上面 internal 是 dstat 本身自带的一些监控参数，下面 <code>/usr/share/dstat</code>中是 dstat 的插件，这些插件可以扩展 dstat 的功能，如可以监控电源（battery）、mysql等。<br>下面这些插件并不是都可以直接使用的，有的还依赖其他包，如想监控 mysql，必须要装 python 连接 mysql 的一些包。</p><h3 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h3><p>用法可以用 <code>-h</code> 选项看下，或者 <code>man dstat</code> 查一下。我执行了一下，大概是这样的：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@pandora ~]# dstat -h</span><br><span class="line">Usage: dstat [-afv] [options..] [delay [count]]</span><br><span class="line">Versatile tool for generating system resource statistics</span><br><span class="line"></span><br><span class="line">Dstat options:</span><br><span class="line">  -c, --cpu              enable cpu stats</span><br><span class="line">     -C 0,3,total           include cpu0, cpu3 and total</span><br><span class="line">  -d, --disk             enable disk stats</span><br><span class="line">     -D total,hda           include hda and total</span><br><span class="line">  -g, --page             enable page stats</span><br><span class="line">  -i, --int              enable interrupt stats</span><br><span class="line">     -I 5,eth2              include int5 and interrupt used by eth2</span><br><span class="line">  -l, --load             enable load stats</span><br><span class="line">  -m, --mem              enable memory stats</span><br><span class="line">  -n, --net              enable network stats</span><br><span class="line">     -N eth1,total          include eth1 and total</span><br><span class="line">  -p, --proc             enable process stats</span><br><span class="line">  -r, --io               enable io stats (I/O requests completed)</span><br><span class="line">  -s, --swap             enable swap stats</span><br><span class="line">     -S swap1,total         include swap1 and total</span><br><span class="line">  -t, --time             enable time/date output</span><br><span class="line">  -T, --epoch            enable time counter (seconds since epoch)</span><br><span class="line">  -y, --sys              enable system stats</span><br><span class="line"></span><br><span class="line">  --aio                  enable aio stats</span><br><span class="line">  --fs, --filesystem     enable fs stats</span><br><span class="line">  --ipc                  enable ipc stats</span><br><span class="line">  --lock                 enable lock stats</span><br><span class="line">  --raw                  enable raw stats</span><br><span class="line">  --socket               enable socket stats</span><br><span class="line">  --tcp                  enable tcp stats</span><br><span class="line">  --udp                  enable udp stats</span><br><span class="line">  --unix                 enable unix stats</span><br><span class="line">  --vm                   enable vm stats</span><br><span class="line"></span><br><span class="line">  --plugin-name          enable plugins by plugin name (see manual)</span><br><span class="line">  --list                 list all available plugins</span><br><span class="line"></span><br><span class="line">  -a, --all              equals -cdngy (default)</span><br><span class="line">  -f, --full             automatically expand -C, -D, -I, -N and -S lists</span><br><span class="line">  -v, --vmstat           equals -pmgdsc -D total</span><br><span class="line"></span><br><span class="line">  --bw, --blackonwhite   change colors for white background terminal</span><br><span class="line">  --float                force float values on screen</span><br><span class="line">  --integer              force integer values on screen</span><br><span class="line">  --nocolor              disable colors (implies --noupdate)</span><br><span class="line">  --noheaders            disable repetitive headers</span><br><span class="line">  --noupdate             disable intermediate updates</span><br><span class="line">  --output file          write CSV output to file</span><br><span class="line"></span><br><span class="line">delay is the delay in seconds between each update (default: 1)</span><br><span class="line">count is the number of updates to display before exiting (default: unlimited)</span><br></pre></td></tr></table></figure><p>直接执行 <code>dstat</code> 这个命令，默认选项是 <code>-cdngy</code>，1s 显示一条信息。可以在最后指定显示一条信息的时间间隔，如<code>dstat 5</code>是每 5s 显示一条，<code>dstat 5 10</code>表示每 5s 显示一条，一共显示 10 条。</p><p>一个可能的输出如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@pandora ~]# dstat</span><br><span class="line">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--</span><br><span class="line">usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw</span><br><span class="line">  3   4  92   0   0   0| 135k 4182k|   0     0 |  52k   86k|  20k   50k</span><br><span class="line">  4   3  93   0   0   0|   0  3668k|5873B 5436B|   0   120k|  30k   51k</span><br><span class="line">  4   3  93   0   0   0|   0  3632k|6040B 4520B|   0   100k|  32k   55k</span><br><span class="line">  4   3  93   0   0   0|4096B 3832k|3274B 1574B|   0    72k|  30k   50k</span><br><span class="line">  4   3  93   0   0   0|   0  3644k|3404B 1654B|   0   120k|  33k   57k</span><br></pre></td></tr></table></figure><p>可以看到的统计项有以下几个：<br><code>-c</code> 选项。CPU 状态：从左到右依次是用户/系统/空闲部分的 cpu 占比，wait，硬/软中断次数。<br><code>-d</code> 选项。磁盘状态：磁盘的读写操作，这一栏显示磁盘的读、写总数。<br><code>-n</code> 选项。网络状态：网络设备发送和接受的数据。<br><code>-g</code> 选项。页面状态：系统的分页活动，分页指的是一种内存管理技术用于查找系统场景，一个较大的分页表明系统正在使用大量的交换空间，或者说内存非常分散，大多数情况下你都希望看到 page in（换入）和 page out（换出）的值是 0。<br><code>-y</code> 选项。系统统计：中断（int）和上下文切换（csw）数量。较高的值通常表示大量的进程造成拥塞，需要对 CPU 进行关注。</p><h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><p><code>--socket</code> 显示常用的 socket 统计<br><code>--tcp</code> 显示常用的TCP统计<br><code>--mem</code> 显示内存使用率<br><code>--io</code> 显示I/O统计<br><code>--int</code> 显示终端统计</p><p><code>--disk-util</code> 显示某一时间磁盘的忙碌状况<br><code>--freespace</code> 显示当前磁盘空间使用率<br><code>--proc-count</code> 显示正在运行的程序数量<br><code>--top-bio</code> 指出块I/O最大的进程<br><code>--top-cpu</code> 图形化显示CPU占用最大的进程<br><code>--top-io</code> 显示正常I/O最大的进程<br><code>--top-mem</code> 显示占用最多内存的进程</p><p>一个可能的输出如下：</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@pandora ~]# dstat --tcp --io --top-cpu --top-io --mem --top-mem</span><br><span class="line">----tcp-sockets---- --io/total- -most-expensive- ----most-expensive---- ------memory-usage----- --most-expensive-</span><br><span class="line">lis act syn tim clo| read  writ|  cpu process   |     i/o process      | used  buff  cach  free|  memory process</span><br><span class="line"> 12  29   0   0   0|4.93  46.2 |codis-config 0.0|sshd        102k   46k|38.7G  333M 60.4G  152G|java         183M</span><br><span class="line"> 12  29   0   0   0|   0  27.0 |irqbalance   0.0|irqbalance   48k    0 |38.7G  333M 60.4G  152G|java         183M</span><br><span class="line"> 12  29   0   0   0|   0  4.00 |codis-config 0.0|redis-serve  34k   47B|38.7G  333M 60.4G  152G|java         183M</span><br><span class="line"> 12  29   0   0   0|   0  1.00 |bin/codis-con0.0|redis-serve  34k   54B|38.7G  333M 60.3G  152G|java         183M</span><br></pre></td></tr></table></figure></div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/shell/">shell</a></div><div class="social-share" data-disabled="google,facebook,qzone,twitter,diandian,linkedin,qzone,tencent"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/ba6bb8e7.html"><i class="fa fa-chevron-left"></i><span>Redis 基本数据结构之双向链表</span></a></div><div class="next-post pull-right"><a href="/211b84d9.html"><span>irqbalance 详解之一</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg1MS8xMzM4Nw"><script>!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script></div></div></div><footer class="footer-bg" style="background-image:url(https://s2.ax1x.com/2019/11/17/Mr5txK.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;&nbsp;2016 - 2019 By Happen</div><div class="framework-info"><span>Powered by</span> <a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme -</span> <a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)&&($("#nav").addClass("is-mobile"),$("footer").addClass("is-mobile"))</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49b1f5">hexo-generator-search</a> <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>