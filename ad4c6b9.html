<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/images/dolphin.png"><link rel="icon" type="image/png" href="/images/dolphin.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="Happen"><meta name="keywords" content=""><title>java 第三方包学习之 jsoup - Happen&#39;s Memo</title><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css"><link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"><link rel="stylesheet" href="/css/main.css"><link defer="defer" rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="/css/custom.css"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"> <a class="navbar-brand" href="/">&nbsp;<strong>Happen's Memo</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="fa fa-home" aria-hidden="true"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="fa fa-archive" aria-hidden="true"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="fa fa-map-signs" aria-hidden="true"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="fa fa-tags" aria-hidden="true"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="fa fa-child" aria-hidden="true"></i> 关于</a></li><li class="nav-item" id="search-btn"> <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/images/about-banner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask rgba-black-light flex-center"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><p class="mt-3 post-meta"><i class="fas fa-calendar-alt" aria-hidden="true"></i> 2016/08/12, 星期五, 23:44</p><p class="mt-1"><span class="post-meta"><i class="far fa-chart-bar"></i> 2.1k 字</span><span class="post-meta"><i class="far fa-clock"></i> 8 分钟</span><span id="busuanzi_container_page_pv" class="post-meta" style="display:none"><i class="far fa-eye" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span> 次</span></p></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5 z-depth-3" id="board"><div class="post-content mx-auto" id="post"><p class="note note-warning">本文最后更新于：2020/04/03, 星期五, 02:24</p><div class="markdown-body"><p>使用 python 写爬虫的人，应该都听过 beautifulsoup4 这个包，用来解析 HTML 很方便。现在介绍一个类似于 beautifulsoup4 的 java 第三方库，功能类似。jsoup 是一个解析 HTML 的第三方 java 库，它提供了一套非常方便的 API，可使用 DOM，CSS 以及类 jQuery 的操作方法来取出和操作数据。</p><a id="more"></a><h2 id="简介">简介</h2><p>jsoup 是一个解析 HTML 的第三方 java 库，它提供了一套非常方便的 API，可使用 DOM，CSS 以及类 jQuery 的操作方法来取出和操作数据。<br> <strong>jsoup 这个包类似与 python 中流行的 HTML 解析包 Beautifulsoup4。</strong><br> jsoup 实现了 WHATWG HTML5 规范，能够与现代浏览器解析成相同的 DOM。其解析器能够尽最大可能从你提供的 HTML 文档来创建一个干净的解析结果，无论 HTML 的格式是否完整。比如它可以处理：没有关闭的标签，比如：</p><pre><code class="language-html">&lt;p&gt;Lorem &lt;p&gt;Ipsum parses to &lt;p&gt;Lorem&lt;/p&gt; &lt;p&gt;Ipsum&lt;/p&gt;
</code></pre><p>隐式标签，创建可靠的文档结构（html 标签包含 head 和 body，在 head 只出现恰当的元素）。<br> <strong>官网地址</strong> <a href="https://jsoup.org/" target="_blank" rel="noopener">在这里</a> ， 对应的中文文档 <a href="http://www.open-open.com/jsoup/parsing-a-document.htm" target="_blank" rel="noopener">在这里</a> ，以及 jar 包的 <a href="https://jsoup.org/download" target="_blank" rel="noopener">下载地址</a>。</p><h2 id="一个文档的对象模型">一个文档的对象模型</h2><ul><li>文档由多个 <strong>Elements</strong> 和<strong>TextNodes</strong>组成 ;</li><li>其继承结构如下：<strong>Document</strong>继承 <strong>Element</strong> 继承 <strong>Node</strong>, <strong>TextNode</strong> 继承 <strong>Node</strong>.</li><li>一个 Element 包含一个子节点集合，并拥有一个父 Element。他们还提供了一个唯一的子元素过滤列表。</li></ul><h2 id="获取 -Document- 对象">获取 Document 对象</h2><p>jsoup 可以从包括字符串、URL 地址以及本地文件来加载 HTML 文档，并生成 Document 对象实例。</p><pre><code class="language-java">// (1)从字符串中获取
String html = &quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;First parse&lt;/title&gt;&lt;/head&gt;&quot;
  + &quot;&lt;body&gt;&lt;p&gt;Parsed HTML into a doc.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
Document doc1 = Jsoup.parse(html);

// (2)从 URL 直接加载 HTML 文档
// get 方法
Document doc2 = Jsoup.connect(&quot;http://www.163.com&quot;).get();
// post 方法
Document doc = Jsoup.connect(&quot;http://example.com&quot;)
  .data(&quot;query&quot;, &quot;Java&quot;)
  .userAgent(&quot;Mozilla&quot;)
  .cookie(&quot;auth&quot;, &quot;token&quot;)
  .timeout(3000)
  .post();

  // (3)从文件中加载 HTML 文档
File input = new File(&quot;D:/test.html&quot;);
Document doc = Jsoup.parse(input,&quot;UTF-8&quot;,&quot;http://www.163.com/&quot;);
</code></pre><p>常用到的方法如下：</p><pre><code class="language-java">public static Connection connect(String url)
public static Document parse(String html, String baseUri)
public static Document parse(URL url,  int timeoutMillis) throws IOException
public static Document parse(File in,  String charsetName) throws IOException
public static Document parse(InputStream in, String charsetName,  String baseUrl)  throws IOException
</code></pre><p><strong>parse</strong> 方法能够将输入的 HTML 解析为一个新的文档 (Document），只要解析的不是空字符串，就能返回一个结构合理的文档，其中包含(至少) 一个 head 和一个 body 元素。<br> 上面的参数 <strong>baseUri</strong>的作用是，如果要解析的 html 中存在 <strong>相对路径</strong> ，那么就根据这个参数变成 <strong>绝对路径</strong>, 如果不需要可以传入一个空字符串。</p><p>** 注：** 通过 connect 方法来获得 html 源码，有的时候会遇到乱码的问题，这个时候该怎么办么？方法里有一个 parse 方法，传入参数 InputStream、charsetName 以及 baseUrl，所有可以这样解决：</p><pre><code class="language-java">String url = &quot;http://xxxxxxx&quot;;
Document document = Jsoup.parse(new URL(url).openStream(), &quot;GBK&quot;, url);// 以 gbk 编码为栗。
</code></pre><p><strong>Jsoup 的强项是解析 html，当然了，它能处理一些简单情况，遇到复杂的情形还是使用 httpClient 这个包吧，你值得拥有！</strong></p><h2 id="解析并提取 -HTML- 元素">解析并提取 HTML 元素</h2><h3 id="使用传统的操作 DOM 的方式">使用传统的操作 DOM 的方式</h3><p>举个栗子</p><pre><code class="language-java">Element content = doc.getElementById(&quot;content&quot;);
Elements links = content.getElementsByTag(&quot;a&quot;);
Elements mx = content.getElementsByClass(&quot;help&quot;);
</code></pre><p><strong>注</strong>：doc 为 Document 对象。<br> 还有写常用的方法，比如</p><pre><code class="language-java">public Elements getElementsByAttributeValue(String key,  String value)
public Element attr(String attributeKey,  String attributeValue)
public Elements getAllElements()
// 获得孩子节点中所有的文本拼接
public String text()
// 获得节点的内部 html
public String html()
</code></pre><p>Document 对象还有一个方法</p><pre><code class="language-java">// 获取标题
public String title()
// 获得某节点的 html，这个方法继承自 Node 类，所以 Element 类也有该方法
public String outerHtml()
</code></pre><h3 id="选择器">选择器</h3><p>在元素检索方面，jsoup 的选择器简直无所不能。<br> jsoup 选择器很多，这里仅仅举出几个栗子，</p><pre><code class="language-java">Elements links = doc.select(&quot;a[href]&quot;); // 具有 href 属性的 a 标签
Elements pngs = doc.select(&quot;img[src$=.png]&quot;);// src 属性以.png 结尾的 img 标签
Element masthead = doc.select(&quot;div.masthead&quot;).first();// class 属性为 masthead 的 div 标签中的第一个
Elements resultLinks = doc.select(&quot;h3.r &gt; a&quot;); // class 属性为 r 的 h3 标签的直接子 a 标签
Elements resultLinks = doc.select(img[src~=(?i)\.(png|jpe?g)])
</code></pre><p>Selector 选择器概述</p><pre><code class="language-oth">tagname: 通过标签查找元素，比如：a
ns|tag: 通过标签在命名空间查找元素，比如：可以用 fb|name 语法来查找 &lt;fb:name&gt; 元素
#id: 通过 ID 查找元素，比如：#logo
.class: 通过 class 名称查找元素，比如：.masthead
[attribute]: 利用属性查找元素，比如：[href]
[^attr]: 利用属性名前缀来查找元素，比如：可以用[^data-] 来查找带有 HTML5 Dataset 属性的元素
[attr=value]: 利用属性值来查找元素，比如：[width=500]
[attr^=value], [attr$=value], [attr*=value]: 利用匹配属性值开头、结尾或包含属性值来查找元素，比如：[href*=/path/]
[attr~=regex]: 利用属性值匹配正则表达式来查找元素，比如： img[src~=(?i)\.(png|jpe?g)]
*: 这个符号将匹配所有元素
</code></pre><p>Selector 选择器组合使用</p><p><code>el#id</code> 元素 +ID，比如： div#logo<br> <code>el.class</code> 元素 +class，比如： div.masthead<br> <code>el[attr]</code> 元素 +class，比如： a[href]<br> <code>任意组合</code> 比如：a[href].highlight<br> <code>ancestor child</code> 查找某个元素下子元素，比如：可以用.body p 查找在 &quot;body&quot; 元素下的所有 p 元素<br> <code>parent &gt; child</code> 查找某个父元素下的直接子元素，比如：可以用 div.content &gt; p 查找 p 元素，也可以用 body &gt; * 查找 body 标签下所有直接子元素<br> <code>siblingA + siblingB</code> 查找在 A 元素之前第一个同级元素 B，比如：div.head + div<br> <code>siblingA ~ siblingX</code> 查找 A 元素之前的同级 X 元素，比如：h1 ~ p<br> <code>el, el, el</code> 多个选择器组合，查找匹配任一选择器的唯一元素，例如：div.masthead, div.logo</p><p>伪选择器 selectors</p><p><code>:lt(n)</code> 查找哪些元素的同级索引值（它的位置在 DOM 树中是相对于它的父节点）小于 n，比如：td:lt(3) 表示小于三列的元素<br> <code>:gt(n)</code>查找哪些元素的同级索引值大于 n，比如： div p:gt(2)表示哪些 div 中有包含 2 个以上的 p 元素<br> <code>:eq(n)</code> 查找哪些元素的同级索引值与 n 相等，比如：form input:eq(1)表示包含一个 input 标签的 Form 元素<br> <code>:has(seletor)</code> 查找匹配选择器包含元素的元素，比如：div:has§表示哪些 div 包含了 p 元素<br> <code>:not(selector)</code> 查找与选择器不匹配的元素，比如： div:not(.logo) 表示不包含 class=logo 元素的所有 div 列表<br> <code>:contains(text)</code> 查找包含给定文本的元素，搜索不区分大不写，比如： p:contains(jsoup)<br> <code>:containsOwn(text)</code> 查找直接包含给定文本的元素<br> <code>:matches(regex)</code> 查找哪些元素的文本匹配指定的正则表达式，比如：div:matches((?i)login)<br> <code>:matchesOwn(regex)</code> 查找自身包含文本匹配指定正则表达式的元素</p><p><strong>注：</strong> 上述伪选择器索引是从 0 开始的，也就是说第一个元素索引值为 0，第二个元素 index 为 1 等。<br> 对于 Elements 的来历，看这里</p><pre><code class="language-java">public class Elements extends ArrayList&lt;Element&gt;
</code></pre><p>另外，可以查看 <a href="https://jsoup.org/apidocs/org/jsoup/select/Selector.html" target="_blank" rel="noopener">Selector API</a> 参考来了解更详细的内容<br> 可以看出，jsoup 使用跟 jQuery 一模一样的选择器对元素进行检索，以上的检索方法如果换成是其他的 HTML 解释器，至少都需要很多行代码，而 jsoup 只需要一行代码即可完成。</p><h2 id="修改获取数据">修改获取数据</h2><pre><code class="language-java"> // 为所有链接增加 rel=nofollow 属性
doc.select(&quot;div.comments a&quot;).attr(&quot;rel&quot;, &quot;nofollow&quot;);
 // 为所有链接增加 class=mylinkclass 属性
doc.select(&quot;div.comments a&quot;).addClass(&quot;mylinkclass&quot;);
// 删除所有图片的 onclick 属性
doc.select(&quot;img&quot;).removeAttr(&quot;onclick&quot;);
// 清空所有文本输入框中的文本
doc.select(&quot;input[type=text]&quot;).val(&quot;&quot;);
// 获得 rel 属性的值
doc.select(&quot;div.comments a&quot;).attr(&quot;rel&quot;);
</code></pre><h2 id="参考">参考</h2><ol><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jsouphtml/" target="_blank" rel="noopener">使用 jsoup 对 HTML 文档进行解析和操作</a></li><li><a href="https://jsoup.org/apidocs/" target="_blank" rel="noopener">jsoup 1.9.2 API</a></li></ol></div><hr><div><p><span><i class="iconfont icon-inbox"></i> <a class="hover-with-bg" href="/categories/quick-start/">quick-start</a> &nbsp;</span> &nbsp;&nbsp;<span><i class="iconfont icon-tag"></i> <a class="hover-with-bg" href="/tags/java/">java</a></span></p><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/d94122d2.html"><i class="fa fa-chevron-left"></i> <span class="hidden-mobile">小白学 golang</span> <span class="visible-mobile">上一篇</span></a></div><div class="post-next col-6"> <a href="/9cd13682.html"><span class="hidden-mobile">python 标准库之 pickle 模块</span> <span class="visible-mobile">下一篇</span><i class="fa fa-chevron-right"></i></a></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg1MS8xMzM4Nw"><script type="text/javascript">!function(e,t){var r,n=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((r=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",r.defer=!0,n.parentNode.insertBefore(r,n))}(document,"script")</script><noscript> 为正常使用来必力评论功能请激活JavaScript</noscript></div></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc-start"></div><div id="toc"><p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-content mx-auto"> <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:150px;height:150px"></div></div></main><a class="z-depth-1" id="scroll-top-button" href="#" role="button"><i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4> <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"> <input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a><i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><b>Fluid</b></a></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js"></script><script>$(document).ready(function(){var s=$("#navbar").height(),c=$("#toc"),t=$("#board-ctn"),o=t.offset().top,i=2*o+t.height();$(window).scroll(function(){var t=$("#toc-start").offset().top-s,o=document.body.scrollTop+document.documentElement.scrollTop;t<=o&&o<=i?c.css({display:"block",position:"fixed",top:s}):o<=t?c.css({position:"",top:""}):i<o&&c.css("display","none")}),tocbot.init({tocSelector:"#tocbot",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,headingsOffset:-o}),0<$(".toc-list-item").length&&$("#toc > p").css("visibility","visible");var l=t.css("margin-right");$("#toc-ctn").css({right:l})})</script><script defer="defer" src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer="defer" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script defer="defer">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?882b48640075e00a238ae94a7eec0d40";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script defer="defer">var _mtac={};!function(){var t=document.createElement("script");t.src="//pingjs.qq.com/h5/stats.js?v2.0.4",t.setAttribute("name","MTAH5"),t.setAttribute("sid","");var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js"></script><script>$(document).ready(function(){$("pre").addClass("prettyprint  "),prettyPrint()})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","java 第三方包学习之 jsoup&nbsp;"],cursorChar:"_",typeSpeed:80,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){getSearchFile(path),this.onclick=null}</script><script defer="defer" src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script>$("#post img:not(.no-zoom img, img[no-zoom])").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>