<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="apple-touch-icon" sizes="76x76" href="/images/dolphin.png"><link rel="icon" type="image/png" href="/images/dolphin.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#433d3c"><meta name="description" content=""><meta name="author" content="Happen"><meta name="keywords" content=""><title>git 使用笔记 - HappenのMemo</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/rainbow.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body><header style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>HappenのMemo</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/happencc/pics/raw/master/images/about-banner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Happen </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-09-12 02:43" pubdate>2020-09-12 02:43</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 23 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">git 使用笔记</h1><p class="note note-info">本文最后更新于：2020-09-12 02:43</p><div class="markdown-body" id="post-body"><p>本文档主要记录 git 日常高频使用命令。<br><a id="more"></a></p><p>本地仓库由 git 维护的三棵“树”组成。<br>第一个是 <strong>工作目录 </strong>，它持有实际文件；<br>第二个是 <strong>暂存区（Index）</strong>，它像个缓存区域，临时保存改动；<br>最后是 <strong>HEAD</strong>，它指向你最后一次提交的结果。<br>如下图所示，</p><p><img src="https://gitee.com/happencc/pics/raw/master/images/git-flow.png" srcset="/img/loading.gif" alt=""></p><h2 id="新建"><a href="# 新建" class="headerlink" title="新建"></a>新建</h2><ol><li><code>git init</code>，创建一个新的本地仓库。</li><li><code>git clone -b &lt; 远端分支名 &gt; &lt;url&gt; &lt;local-name&gt;</code>，从远端 url 拉取仓库拉取制定分支到本地 local-name 文件夹下，如果不加远端分支名，则为默认分支 master。</li></ol><h2 id="提交"><a href="# 提交" class="headerlink" title="提交"></a>提交</h2><ol><li><code>git add &lt;file1&gt; &lt;file2&gt; ...</code> 将 working dir 相应文件的更改提交到 index 中。</li><li><code>git add .</code> 提交所有文件的更改。</li><li><code>git commit -m &#39;cmmit xx&#39;</code> 将 index 中的内容提交到本地仓库，HEAD 指向最新提交。</li><li><code>git commit -a -m &#39;commit xx&#39;</code> 将 working dir 所有更改一次性提交到本地仓库。</li><li><code>git commmit</code> 作用同 3，但是会弹出窗口，支持更长的 commit 信息。</li><li><code>git push &lt; 上游 &gt; &lt; 上游分支 &gt;</code> 代码提交到远端库。</li></ol><h2 id="commit- 信息变更"><a href="#commit- 信息变更" class="headerlink" title="commit 信息变更"></a>commit 信息变更</h2><ol><li><code>git commit --amend</code> 进入编辑器，修改上一次的 commit 信息。</li><li><code>git rebase -i &lt;commitid&gt;</code> 合并 commit。</li></ol><p>举例说明，使用 <code>git log</code> 查看，有以下 4 个 commit，</p><div class="hljs"><pre><code class="hljs shell">commit C4
Date:   Sun Jun 21 17:25:56 2020 +0800
    add line11

commit C3
Date:   Sun Jun 21 17:24:33 2020 +0800
    add line10

commit C2
Date:   Sun Jun 21 11:49:06 2020 +0800
    add line1
    commbine 1

commit C1
Date:   Sun Jun 21 11:45:06 2020 +0800
    add newfile</code></pre></div><p>现在，我想要将 C2 和 C3 合并，那么找到最早的 commit C2 的上一个 C1(或者使用 <code>C2^</code>)，执行 <code>git rebase -i C1</code>，会出现合并 commit 选择的页面，大概如下，</p><div class="hljs"><pre><code class="hljs shell">pick C2 add line1
pick C3 add line10
pick C4 add line11

<span class="hljs-meta">#</span><span class="bash"> Commands:</span>
<span class="hljs-meta">#</span><span class="bash"> p, pick = use commit</span>
<span class="hljs-meta">#</span><span class="bash"> r, reword = use commit, but edit the commit message</span>
<span class="hljs-meta">#</span><span class="bash"> e, edit = use commit, but stop <span class="hljs-keyword">for</span> amending</span>
<span class="hljs-meta">#</span><span class="bash"> s, squash = use commit, but meld into previous commit</span>
<span class="hljs-meta">#</span><span class="bash"> f, fixup = like <span class="hljs-string">&quot;squash&quot;</span>, but discard this commit<span class="hljs-string">&#x27;s log message</span></span>
<span class="hljs-meta">#</span><span class="bash"> x, <span class="hljs-built_in">exec</span> = run <span class="hljs-built_in">command</span> (the rest of the line) using shell</span>
<span class="hljs-meta">#</span><span class="bash"> d, drop = remove commit</span></code></pre></div><p>根据命令说明，将要合并的 commit 前面的命令改成 <code>f</code> 或者 <code>s</code>, 两者的区别的是 <code>f</code> 在编辑合并后 commit 的信息时只会出现最后一条，而 <code>s</code> 都会保存，<strong>建议使用</strong> <code>s</code> 。要合并 C2 和 C3 的话，那么选择时间早的 C2，所以把 C3 前的 <code>pick</code> 改为 <code>s</code>，保存。</p><p>接着会出现编辑页，编辑合并后 commit 的提交信息，改好以后再次保存就可。</p><p class="note note-warning">要合并的 C2 和 C3 是连续的 commit。</p><h2 id="撤销"><a href="# 撤销" class="headerlink" title="撤销"></a>撤销</h2><ol><li><code>git checkout -- &lt;file&gt;</code> 撤销一个工作区文件（必须是已经被 track 的文件）的修改。<code>&lt;file&gt;</code> 参数为 <code>.</code> 时表示撤销所有修改。</li><li><code>git rm --cached &lt;file&gt;</code> 从 index 中删除一个文件，使之变为 <strong>Untracked files</strong> 状态。</li><li><code>git reset HEAD &lt;file&gt;</code> 从 index 中撤销一个更改。</li><li><code>git reset --soft &lt;commitid&gt;</code> 从本地仓库 HEAD 回滚到 index 区（未 commit 的状态）。</li><li><code>git reset --mixed &lt;commitid&gt;</code> 从本地仓库 HEAD 回滚到工作区（未 add 的状态）。</li><li><code>git reset --hard &lt;commitid&gt;</code> 从本地仓库 HEAD 做版本回退（工作区未更改，已提交）。</li><li><p><code>git revert --no-commit &lt;commit1&gt;..&lt;commit2&gt;</code> 撤销指定 cimmit 的代码提交。<br>撤销从 commit1 到 commit2 的提交，区间前开后闭区间。<code>--no-commit</code> 表示可以最后一起手动 git commit 提交。<br><strong>revert</strong> 其实是将要取消的提交记录按照相反的操作将他们抵消掉，然后重新生成一个提交记录，这样在提交记录的完整性上更好，不同于 <strong>reset</strong> 的直接抹掉。<br><strong>有冲突时需要手动修复</strong>，add 后再次 continue。</p></li><li><p><code>git merge --abort</code> 抛弃合并过程并且尝试重建合并前的状态。<strong>该命令仅仅在合并后导致冲突时才使用</strong>。</p></li></ol><h2 id="分支管理"><a href="# 分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><ol><li><code>git checkout -b &lt;banch name&gt; &lt;base branch&gt;</code> 基于 base 分支创建一个新分支，并切到新分支。<strong>base 分支为空时</strong>，表示为当前分支，<strong>base 分支如果为远端分支</strong>，则要加上游分支名字，如 <code>origin/dev</code>。</li><li><code>git checkout &lt;branch name&gt;</code> 切到某分支。</li><li><code>git branch -a</code> 查看所有分支。</li></ol><h2 id="代码 -diff"><a href="# 代码 -diff" class="headerlink" title="代码 diff"></a>代码 diff</h2><ol><li><p><code>git diff &lt;commit1&gt; &lt;commit2&gt; &lt;filename&gt;</code> 比较 file 在两个版本之前的差异。<br>如果不加 filename，那么比较所有文件的差异，<br>如果只有一个 commitid，表示指定 commitid 与当前版本的差异。<br>如果没有 commitid，只有 filename，比较某个文件与 HEAD 中的差异。<br>如果后面什么参数也没有，表示与 HEAD 的所有差异。</p></li><li><p><code>git diff --staged/--cached</code> 比较暂存区 / 工作区与上一次提交的差异。</p></li></ol><h2 id="删除文件 - 分支"><a href="# 删除文件 - 分支" class="headerlink" title="删除文件 / 分支"></a>删除文件 / 分支</h2><ol><li><code>git branch -d &lt;branch name&gt;</code> 删除本地分支。</li><li><code>git push origin --delete &lt;branch name&gt;</code> 删除远端分支。</li><li><code>git rm --cached &lt;file&gt;</code> 并进行提交，完成本地文件在远端的删除。</li></ol><h2 id="代码合并"><a href="# 代码合并" class="headerlink" title="代码合并"></a>代码合并</h2><ol><li><p><code>git merge &lt;feature&gt; &lt;master&gt;</code> 在 feature 上合并 master(这可能出现冲突，需要自行解决)，<br>如果参数只有一个 branch，则表示与当前分支合并。<br><img src="https://gitee.com/happencc/pics/raw/master/images/git-merge.jpg" srcset="/img/loading.gif" alt=""></p><p>feature 分支每次需要合并上游更改时，它都将产生一个额外的合并提交。如果 master 提交非常活跃，这可能会 <strong>严重污染你的 feature 分支历史记录</strong>。</p></li><li><code>git rebase -i &lt;branch name&gt;</code> 交互式合并指定分支。<br><img src="https://gitee.com/happencc/pics/raw/master/images/git-rebase.jpg" srcset="/img/loading.gif" alt=""></li></ol><p>rebase 通过为原始分支中的每个提交创建全新的 commits 来 重写 项目历史记录。</p><p>rebase 的主要好处是可以获得更清晰的项目历史。<br><strong>在提交拉取请求之前，通常使用交互式 rebase 清理代码通常是个好的办法，但是在别人使用的分支（公共分支）上进行 rebase，重写其历史记录将使 Git 和你的队友无法跟踪添加到该功能的任何后续提交，也会在别人拉取代码时产生冲突</strong>。</p><p>在你运行 <code>git rebase</code> 命令之前，总是问自己，还有其他人在用这个分支吗？ 如果答案是肯定的，那就把你的手从键盘上移开，开始考虑采用非破坏性的方式进行改变（例如，<code>git merge</code> 命令）。否则，你可以随心所欲地重写历史记录。</p><ol><li><code>git cherry-pick &lt;commitid1&gt;..&lt;commitid2&gt;</code> 从 commitid1（不包括）到 commitid2 的更改，应用到本分支，如果要包含 commitid1，则使用 <code>commitid1^</code></li></ol><h3 id="好的实践"><a href="# 好的实践" class="headerlink" title="好的实践"></a>好的实践</h3><p><strong>永远不要在公共分支上使用 </strong><code>git rebase</code>。<br>在私人分支，rebase 修改个人本次功能的 commit，通过定期执行交互式 rebase，你可以确保功能中的每个提交都具有针对性和意义。然后 merge 到主分支上。</p><p>更多参考 《<a target="_blank" rel="noopener" href="https://juejin.im/post/5d2d24245188250501477cc4">git rebase VS git merge？ 更优雅的 git 合并方式值得拥有</a>》</p><h2 id="代码拉取"><a href="# 代码拉取" class="headerlink" title="代码拉取"></a>代码拉取</h2><p><code>git pull &lt; 上游 &gt; &lt; 上游分支 &gt;</code> 从上游拉取指定分支。</p><p>如果上游分支与本地分支存在交叉，就会出现 <strong>Merge branch ‘xx’ of xx into xxx</strong> 的自动 commit，所以 <strong>最好在使用 <code>git pull</code> 命令时，后面加上 <code>--rebase</code> 选项 </strong>。<br>如果拉取不产生冲突，会直接 rebase，不会产生分支合并操作，如果有冲突则需要手动 fix 后，自行合并。</p><p class="note note-warning">以上所有使用 commitid 的地方，也都可以使用 HEAD/ HEAD^/HEAD~3 这种方式。</p><p>```</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/tools/">tools</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/git/">git</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/a9d44741.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Redis Cluster write safety 分析</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/f0a45582.html"><span class="hidden-mobile">Redis 源码分析之内存淘汰策略</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg1MS8xMzM4Nw"><script type="text/javascript">function loadLivere(){addScript("https://cdn-city.livere.com/js/embed.dist.js")}waitElementVisible("lv-container",loadLivere)</script><noscript>为正常使用来必力评论功能请允许 JavaScript 运行</noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="footer-content"><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script>var now=new Date;function createtime(){var n=new Date("04/03/2016 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="🚀 &nbsp"+dnum+"&nbsp天",document.getElementById("times").innerHTML=hnum+"&nbsp小时&nbsp"+mnum+"&nbsp分&nbsp"+snum+"&nbsp秒"}setInterval("createtime()",250)</script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","git 使用笔记&nbsp;"],cursorChar:"|",typeSpeed:72,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?14630c2a053c5952e46094f24dabb623";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>