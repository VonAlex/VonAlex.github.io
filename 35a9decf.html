<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@500&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital@1&family=Noto+Sans+TC&family=Noto+Serif+SC:wght@200;300&display=swap" rel="stylesheet"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="apple-touch-icon" sizes="76x76" href="/images/dolphin.png"><link rel="icon" type="image/png" href="/images/dolphin.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#433d3c"><meta name="description" content=""><meta name="author" content="Happen"><meta name="keywords" content=""><title>Redis æºç ä¹‹å¯åŠ¨æµç¨‹ - Happenã®Memo</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/rainbow.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css"><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.1.1"></head><body><header style="height:60vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Happenã®Memo</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> å…³äº</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/happencc/pics/raw/master/images/about-banner.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container page-header text-center fade-in-up"><span class="h2" id="subtitle"></span><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Happen </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2018-12-08 01:07" pubdate>2018-12-08 01:07</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 27 åˆ†é’Ÿ </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> æ¬¡</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto" id="post"><h1 style="display:none">Redis æºç ä¹‹å¯åŠ¨æµç¨‹</h1><p class="note note-info">æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2018-12-08 01:07</p><div class="markdown-body" id="post-body"><p>è¯´è¯´ redis çš„å¯åŠ¨æµç¨‹ã€‚</p><!--more----><p>é¦–å…ˆè¦æ‰¾åˆ° <strong>å¯åŠ¨å‡½æ•° </strong>ï¼Œæˆ‘ä»¬çŸ¥é“ C ç¨‹åºä» <code>main</code> å‡½æ•°å¼€å§‹ï¼Œæ‰€ä»¥ï¼Œå°±æ‰¾åˆ°äº†â€œæ¢¦æƒ³â€å¼€å§‹çš„åœ°æ–¹ <code>server.c</code> -&gt; <code>main</code>ã€‚<br>è¿™é‡Œä¸»è¦è®²å¯åŠ¨è¿‡ç¨‹ä¸­çš„ä¸»è¦éƒ¨åˆ†ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šä¸€ä¸€æ¶‰åŠåˆ°ã€‚</p><h2 id="å¤§æ¦‚å¯åŠ¨æµç¨‹"><a href="# å¤§æ¦‚å¯åŠ¨æµç¨‹" class="headerlink" title="å¤§æ¦‚å¯åŠ¨æµç¨‹"></a>å¤§æ¦‚å¯åŠ¨æµç¨‹</h2><h3 id="initServerConfig- å‡½æ•°"><a href="#initServerConfig- å‡½æ•°" class="headerlink" title="initServerConfig å‡½æ•°"></a>initServerConfig å‡½æ•°</h3><p>æ•´ä¸ªä»£ç ä¸­æœ€é‡è¦çš„ç»“æ„ä½“è«è¿‡äº <code>struct redisServer server</code>ï¼Œå®ƒä»¥ä¸€ä¸ªå…¨å±€å˜é‡çš„å½¢å¼å‡ºç°ã€‚æœ¬å‡½æ•°ä¸»è¦æ˜¯å¯¹å®ƒçš„æˆå‘˜è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œè¿™äº›æˆå‘˜åŸºæœ¬ä¸Šæ˜¯å¯ä»¥é€šè¿‡ redis.conf æ–‡ä»¶æ¥é…ç½®ã€‚</p><h4 id="å¤§éƒ¨åˆ†æˆå‘˜èµ‹åˆå€¼"><a href="# å¤§éƒ¨åˆ†æˆå‘˜èµ‹åˆå€¼" class="headerlink" title="å¤§éƒ¨åˆ†æˆå‘˜èµ‹åˆå€¼"></a>å¤§éƒ¨åˆ†æˆå‘˜èµ‹åˆå€¼</h4><p>æ¯”å¦‚ï¼š</p><div class="table-container"><table><thead><tr><th>server å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>runid</td><td>èŠ‚ç‚¹æ ‡è¯†å ç”¨ 40B</td></tr><tr><td>port</td><td>å¯åŠ¨ç«¯å£é»˜è®¤ä¸º 6379</td></tr><tr><td>tcp_backlog</td><td>é»˜è®¤ 511B</td></tr><tr><td>aof_fsync</td><td>é»˜è®¤ aof æ¯ç§’åˆ·ç›˜ï¼Œä½†æ˜¯ aof é»˜è®¤å…³é—­</td></tr><tr><td>aof_filename</td><td>é»˜è®¤ aof æ–‡ä»¶åä¸º appendonly.aof</td></tr><tr><td>rdb_filename</td><td>é»˜è®¤ rdb æ–‡ä»¶åä¸º dump.rdb</td></tr><tr><td>cluster_node_timeout</td><td>é»˜è®¤ 15sï¼Œé»˜è®¤ cluster æ¨¡å¼å…³é—­</td></tr></tbody></table></div><h4 id="é»˜è®¤ -rdb- è§¦å‘æ¡ä»¶"><a href="# é»˜è®¤ -rdb- è§¦å‘æ¡ä»¶" class="headerlink" title="é»˜è®¤ rdb è§¦å‘æ¡ä»¶"></a>é»˜è®¤ rdb è§¦å‘æ¡ä»¶</h4><div class="hljs"><pre><code class="hljs c">appendServerSaveParams(<span class="hljs-number">60</span> * <span class="hljs-number">60</span>,<span class="hljs-number">1</span>);  <span class="hljs-comment">/* save after 1 hour and 1 change */</span>
appendServerSaveParams(<span class="hljs-number">300</span>,<span class="hljs-number">100</span>);    <span class="hljs-comment">/* save after 5 minutes and 100 changes */</span>
appendServerSaveParams(<span class="hljs-number">60</span>,<span class="hljs-number">10000</span>);   <span class="hljs-comment">/* save after 1 minute and 10000 changes */</span></code></pre></div><h4 id="Replication-related"><a href="#Replication-related" class="headerlink" title="Replication related"></a>Replication related</h4><p>åŒ…å«å¯¹ backlog çš„ç›¸å…³è®¾ç½®ã€‚</p><h4 id="Double-constants-initialization"><a href="#Double-constants-initialization" class="headerlink" title="Double constants initialization"></a>Double constants initialization</h4><p>æµ®ç‚¹æ•°æ®ç²¾åº¦è®¾ç½®ã€‚</p><h4 id="client-output-buffer-limit"><a href="#client-output-buffer-limit" class="headerlink" title="client output buffer limit"></a>client output buffer limit</h4><p>ä¸€å…±æœ‰ä¸‰ç§ç±»å‹ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c">clientBufferLimitsConfig clientBufferLimitsDefaults[CLIENT_TYPE_OBUF_COUNT] = &#123;
    &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;,                         <span class="hljs-comment">/* normal */</span>
    &#123;<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">256</span>, <span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">64</span>, <span class="hljs-number">60</span>&#125;, <span class="hljs-comment">/* slave */</span>
    &#123;<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">32</span>, <span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">8</span>, <span class="hljs-number">60</span>&#125;    <span class="hljs-comment">/* pubsub */</span>
&#125;;</code></pre></div><h4 id="redis- å‘½ä»¤è¡¨"><a href="#redis- å‘½ä»¤è¡¨" class="headerlink" title="redis å‘½ä»¤è¡¨"></a>redis å‘½ä»¤è¡¨</h4><p>åˆå§‹åŒ– redis å‘½ä»¤è¡¨æ”¾åˆ° <code>server.commands</code>ä¸­ï¼Œè¿™ä¸»è¦æ˜¯åœ¨ <code>populateCommandTable</code> å‡½æ•°ä¸­å®Œæˆçš„ã€‚</p><p><strong>æ³¨æ„ </strong>ï¼šè€ƒè™‘åˆ°åœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨ rename-command æ¥å¯¹ Command è¿›è¡Œé‡å‘½åï¼ˆé€šå¸¸æ˜¯ä¸ºäº†å®‰å…¨è€ƒè™‘è€Œç¦ç”¨æŸäº›å‘½ä»¤ï¼‰ï¼Œå› æ­¤å‘½ä»¤è¡¨ä¿å­˜äº†<strong> ä¸¤ä»½</strong>ï¼Œå³ <code>server.commands</code> å’Œ <code>server.orig_commands</code>ã€‚</p><p>åŒæ—¶è¿˜å¯¹ä¸€äº›ç»å¸¸æŸ¥è¯¢çš„å‘½ä»¤å•ç‹¬æå‡ºæ¥ï¼Œåˆ†åˆ«æ”¾åˆ°ä»¥ä¸‹å˜é‡ä¸­ï¼Œ</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">redisCommand</span> *<span class="hljs-title">delCommand</span>, *<span class="hljs-title">multiCommand</span>, *<span class="hljs-title">lpushCommand</span>, *<span class="hljs-title">lpopCommand</span>,</span>
<span class="hljs-class">                    *<span class="hljs-title">rpopCommand</span>, *<span class="hljs-title">sremCommand</span>, *<span class="hljs-title">execCommand</span>;</span></code></pre></div><h4 id="Slow-log"><a href="#Slow-log" class="headerlink" title="Slow log"></a>Slow log</h4><p>é»˜è®¤æ—¶é—´ä¸º <strong>10ms</strong>ã€‚</p><h3 id="sentinel- æ¨¡å¼"><a href="#sentinel- æ¨¡å¼" class="headerlink" title="sentinel æ¨¡å¼"></a>sentinel æ¨¡å¼</h3><p>ä»¥ä¸‹æ–¹å¼è¿›è¡Œè¯¥æ¨¡å¼çš„å¼€å¯ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">checkForSentinelMode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>&#123;
    <span class="hljs-keyword">int</span> j;

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strstr</span>(argv[<span class="hljs-number">0</span>],<span class="hljs-string">&quot;redis-sentinel&quot;</span>) != <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">1</span>; j &lt; argc; j++)
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">strcmp</span>(argv[j],<span class="hljs-string">&quot;--sentinel&quot;</span>)) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre></div><p>ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•° <code>--sentinel</code>ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ <code>redis-sentinel</code>ã€‚</p><p><strong>å¦‚æœå¼€å¯ </strong>äº†è¯¥æ¨¡å¼ï¼Œé‚£ä¹ˆè¿›è¡Œç›¸åº”çš„åˆå§‹ï¼Œæ²¡å¼€å¯å°±è·³è¿‡ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (server.sentinel_mode) &#123;
    initSentinelConfig(); <span class="hljs-comment">// sentinel é»˜è®¤ç«¯å£ 26379</span>
    initSentinel(); <span class="hljs-comment">// sentinel å˜é‡èµ‹åˆå€¼</span>
&#125;</code></pre></div><h3 id="å‘½ä»¤è¡Œå‚æ•°è§£æå¹¶è½½å…¥é…ç½®æ–‡ä»¶"><a href="# å‘½ä»¤è¡Œå‚æ•°è§£æå¹¶è½½å…¥é…ç½®æ–‡ä»¶" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°è§£æå¹¶è½½å…¥é…ç½®æ–‡ä»¶"></a>å‘½ä»¤è¡Œå‚æ•°è§£æå¹¶è½½å…¥é…ç½®æ–‡ä»¶</h3><p>ä¸»è¦è¿˜æ˜¯è·å¾—é…ç½®æ–‡ä»¶çš„ <strong>ç»å¯¹è·¯å¾„</strong> <code>server.configfile = getAbsolutePath(configfile)</code>ã€‚</p><p>é…ç½®æ–‡ä»¶çš„è½½å…¥æœ‰ä¸“é—¨çš„å‡½æ•°</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loadServerConfig</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">char</span> *options)</span></span>&#123;&#125;</code></pre></div><p>è½½å…¥é…ç½®æ–‡ä»¶åï¼Œä¼šè¦†ç›–ä¹‹å‰å¯¹äº server çš„æŸäº›é»˜è®¤é…ç½®ã€‚å®é™…ä¸Šï¼Œå½“ redis-server å¯åŠ¨åï¼Œä¸€äº›é…ç½®å¯ä»¥é€šè¿‡ <code>config get</code> å‘½ä»¤æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>config set</code> å‘½ä»¤è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å <code>config rewrite</code> åˆ·ç›˜ã€‚</p><h3 id="initServer- å‡½æ•°"><a href="#initServer- å‡½æ•°" class="headerlink" title="initServer å‡½æ•°"></a>initServer å‡½æ•°</h3><p>ä¸åŒäº <code>initServerConfig</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦åˆå§‹åŒ–ä¸€äº› redis-server è¿è¡Œä¸­çš„æˆå‘˜ã€‚</p><h4 id="ä¿¡å·å¤„ç†"><a href="# ä¿¡å·å¤„ç†" class="headerlink" title="ä¿¡å·å¤„ç†"></a>ä¿¡å·å¤„ç†</h4><p>é€šè¿‡ redis æ¥å¤ä¹ ä¸‹ä¿¡å·å¤„ç†ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-comment">// å¿½ç•¥ SIGHUP å’Œ SIGPIPE ä¿¡å·</span>
signal(SIGHUP, SIG_IGN);
signal(SIGPIPE, SIG_IGN);</code></pre></div><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setupSignalHandlers</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> <span class="hljs-title">act</span>;</span>
    sigemptyset(&amp;act.sa_mask);
    act.sa_flags = <span class="hljs-number">0</span>;
    act.sa_handler = sigShutdownHandler;
    sigaction(SIGTERM, &amp;act, <span class="hljs-literal">NULL</span>);
    sigaction(SIGINT, &amp;act, <span class="hljs-literal">NULL</span>);
    <span class="hljs-keyword">return</span>;
&#125;</code></pre></div><p>ä¸»è¦æ˜¯ç¨‹åºé€€å‡ºçš„å–„åå·¥ä½œã€‚</p><h4 id="ç³»ç»Ÿæ—¥å¿—"><a href="# ç³»ç»Ÿæ—¥å¿—" class="headerlink" title="ç³»ç»Ÿæ—¥å¿—"></a>ç³»ç»Ÿæ—¥å¿—</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (server.syslog_enabled) &#123;
    openlog(server.syslog_ident, LOG_PID | LOG_NDELAY | LOG_NOWAIT,
            server.syslog_facility);
&#125;</code></pre></div><p>å‰ææ˜¯ä½¿ç”¨åˆ°äº†ç³»ç»Ÿçš„ rsyslogã€‚</p><h4 id="createSharedObjects- å‡½æ•°"><a href="#createSharedObjects- å‡½æ•°" class="headerlink" title="createSharedObjects å‡½æ•°"></a>createSharedObjects å‡½æ•°</h4><p>è¯¥å‡½æ•°æŠŠä¸€äº›å¸¸ç”¨çš„å­—ç¬¦ä¸²ä¿å­˜èµ·æ¥ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†å‡å°‘ä¸æ–­ç”³è¯·é‡Šæ”¾æ—¶ CPU æ—¶é—´ï¼Œå†…å­˜ç¢ç‰‡ç­‰ç­‰ã€‚</p><p>æ¯”å¦‚ <code>shared.ok = createObject(OBJ_STRING,sdsnew(&quot;+OK\r\n&quot;))</code>ã€‚</p><p><strong>é¢å¤–è¯´æ˜çš„æ˜¯</strong>ï¼Œè¿™é‡Œè¿˜åˆå§‹åŒ–äº†ä¸€ä¸ªå¾ˆå¤§çš„å…±äº«æ•°å­—å¯¹è±¡ï¼Œ0 åˆ° 999ã€‚å› æ­¤åœ¨è®¾ç½® value æ—¶å¯ä»¥ä½¿ç”¨è¿™äº›æ•°å­—å¯ä»¥å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> OBJ_SHARED_INTEGERS 10000</span>

<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; OBJ_SHARED_INTEGERS; j++) &#123; <span class="hljs-comment">// 10000 ä¸ªæ•°å­—</span>
    shared.integers[j] = createObject(OBJ_STRING,(<span class="hljs-keyword">void</span>*)(<span class="hljs-keyword">long</span>)j);
    shared.integers[j]-&gt;encoding = OBJ_ENCODING_INT;
&#125;</code></pre></div><p><code>struct sharedObjectsStruct shared</code> ä¹Ÿæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p><h4 id="adjustOpenFilesLimit- å‡½æ•°"><a href="#adjustOpenFilesLimit- å‡½æ•°" class="headerlink" title="adjustOpenFilesLimit å‡½æ•°"></a>adjustOpenFilesLimit å‡½æ•°</h4><p>è¯¥å‡½æ•°æ ¹æ®é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æœ€å¤§ client æ•°é‡å¢å¤§å¯ä»¥æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æ•°ã€‚</p><h4 id="åˆ›å»º -eventLoop"><a href="# åˆ›å»º -eventLoop" class="headerlink" title="åˆ›å»º eventLoop"></a>åˆ›å»º eventLoop</h4><div class="hljs"><pre><code class="hljs c">server.el = aeCreateEventLoop(server.maxclients+CONFIG_FDSET_INCR)</code></pre></div><p>è¿™é‡Œå‡è®¾ io å¤šè·¯å¤ç”¨ä½¿ç”¨çš„æ˜¯ epollï¼Œè¿™ä¹Ÿæ˜¯ç”¨çš„æœ€å¤šçš„ã€‚</p><h4 id="åˆå§‹åŒ–æ•°æ®åº“å¯¹è±¡"><a href="# åˆå§‹åŒ–æ•°æ®åº“å¯¹è±¡" class="headerlink" title="åˆå§‹åŒ–æ•°æ®åº“å¯¹è±¡"></a>åˆå§‹åŒ–æ•°æ®åº“å¯¹è±¡</h4><div class="hljs"><pre><code class="hljs c">server.db = zmalloc(<span class="hljs-keyword">sizeof</span>(redisDb)*server.dbnum);</code></pre></div><p>æ•°æ®åº“å¯¹è±¡ <code>struct redisDb</code>ï¼Œæœ‰ 16 ä¸ªã€‚</p><h4 id="ç›‘å¬ -port- ç«¯å£"><a href="# ç›‘å¬ -port- ç«¯å£" class="headerlink" title="ç›‘å¬ port ç«¯å£"></a>ç›‘å¬ port ç«¯å£</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (server.port != <span class="hljs-number">0</span> &amp;&amp;
    listenToPort(server.port,server.ipfd,&amp;server.ipfd_count) == C_ERR)
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);</code></pre></div><p>ç›‘å¬ <code>server.port</code>ï¼Œå¹¶æŠŠè¿”å›çš„ fd å­˜å‚¨åœ¨ <code>server.ipfd</code> ä¸­ï¼Œæœ‰æŠ¥é”™å°±è¿”å›ã€‚</p><h4 id="åˆ›å»ºç³»ç»Ÿ -cron- å®šæ—¶å™¨"><a href="# åˆ›å»ºç³»ç»Ÿ -cron- å®šæ—¶å™¨" class="headerlink" title="åˆ›å»ºç³»ç»Ÿ cron å®šæ—¶å™¨"></a>åˆ›å»ºç³»ç»Ÿ cron å®šæ—¶å™¨</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(aeCreateTimeEvent(server.el, <span class="hljs-number">1</span>, serverCron, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>) == AE_ERR) &#123;
    serverPanic(<span class="hljs-string">&quot;Can&#x27;t create the serverCron time event.&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
&#125;</code></pre></div><p>æ³¨å†Œå®šæ—¶æ—¶é—´ï¼Œç»‘å®šå›è°ƒå‡½æ•° <code>serverCron</code>ï¼Œåœ¨è¯¥å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œå‘¨æœŸä¸º <code>1000/server.hz</code> msï¼Œå› æ­¤æ¯ç§’ä¼šæ‰§è¡Œ<code>server.hz</code>ï¼ˆè¯¥å€¼ç”¨æˆ·å¯é…ï¼‰ã€‚</p><p>é‚£ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªé¢‘ç‡å‘¢ï¼Ÿredis ä¸­å¯¹äºäº‹ä»¶å¤„ç†åœ¨ä¹‹å‰çš„ä¸€ç¯‡åšå®¢ä¸­å†™è¿‡ï¼Œå¯ä»¥å‚è€ƒä¸‹ <a target="_blank" rel="noopener" href="http://tech-happen.site/85f7b0b4.html">Redis ä¸­çš„äº‹ä»¶</a>ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç®€å•å›é¡¾ä¸‹ã€‚</p><p>æ—¶é—´äº‹ä»¶å¤„ç†å‡½æ•° <code>ae.c</code>-&gt; <code>processTimeEvents</code> ä¸­ï¼Œä¼šæ ¹æ®æ—¶é—´äº‹ä»¶çš„å›è°ƒè¿”å›å€¼æ¥å†³å®šè¿™æ—¶ä¸€ä¸ªå‘¨æœŸäº‹ä»¶è¿˜æ˜¯ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œå³</p><div class="hljs"><pre><code class="hljs c">&#123;
    <span class="hljs-keyword">int</span> retval;

    id = te-&gt;id;
    retval = te-&gt;timeProc(eventLoop, id, te-&gt;clientData);
    processed++;
    <span class="hljs-keyword">if</span> (retval != AE_NOMORE) &#123;
        aeAddMillisecondsToNow(retval,&amp;te-&gt;when_sec,&amp;te-&gt;when_ms);
    &#125; <span class="hljs-keyword">else</span> &#123;
        te-&gt;id = AE_DELETED_EVENT_ID;
    &#125;
&#125;</code></pre></div><h4 id="ç›‘å¬ - æ¥æ”¶ç”¨æˆ·è¯·æ±‚"><a href="# ç›‘å¬ - æ¥æ”¶ç”¨æˆ·è¯·æ±‚" class="headerlink" title="ç›‘å¬ / æ¥æ”¶ç”¨æˆ·è¯·æ±‚"></a>ç›‘å¬ / æ¥æ”¶ç”¨æˆ·è¯·æ±‚</h4><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; server.ipfd_count; j++) &#123;
    <span class="hljs-keyword">if</span> (aeCreateFileEvent(server.el, server.ipfd[j], AE_READABLE, <span class="hljs-comment">// ç›‘å¬å¯è¯»äº‹ä»¶</span>
                          acceptTcpHandler,<span class="hljs-literal">NULL</span>) == AE_ERR)
    &#123;
        serverPanic(<span class="hljs-string">&quot;Unrecoverable error creating server.ipfd file event.&quot;</span>);
    &#125;
&#125;</code></pre></div><p>æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆç”¨æˆ·è¿æ¥ä¼šä»è¿™é‡Œè¿›æ¥ï¼‰ï¼Œç›‘å¬å¯è¯»äº‹ä»¶ï¼Œæ³¨å†Œå›è°ƒå‡½æ•° <code>acceptTcpHandler</code>ã€‚</p><h4 id="cluster- åˆå§‹åŒ–"><a href="#cluster- åˆå§‹åŒ–" class="headerlink" title="cluster åˆå§‹åŒ–"></a>cluster åˆå§‹åŒ–</h4><p>å¦‚æœå¼€å¯äº† cluster modeï¼Œä¼šè¿›è¡Œç›¸åº”çš„åˆå§‹åŒ–ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (server.cluster_enabled) clusterInit();</code></pre></div><h4 id="å…¶ä»–ç¯å¢ƒåˆå§‹åŒ–"><a href="# å…¶ä»–ç¯å¢ƒåˆå§‹åŒ–" class="headerlink" title="å…¶ä»–ç¯å¢ƒåˆå§‹åŒ–"></a>å…¶ä»–ç¯å¢ƒåˆå§‹åŒ–</h4><div class="hljs"><pre><code class="hljs c">replicationScriptCacheInit();
scriptingInit(<span class="hljs-number">1</span>);
slowlogInit();
latencyMonitorInit();
bioInit();</code></pre></div><h3 id="è®¾ç½®è¿›ç¨‹å"><a href="# è®¾ç½®è¿›ç¨‹å" class="headerlink" title="è®¾ç½®è¿›ç¨‹å"></a>è®¾ç½®è¿›ç¨‹å</h3><p>è¿™ä¸ªå‡½æ•°å¾ˆå®ç”¨çš„ï¼Œæ–¹ä¾¿ ps çœ‹åˆ°è‰¯å¥½æ ¼å¼çš„è¿›ç¨‹åã€‚ä¸€èµ·æ¥å¤ä¹ ä¸‹ã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">redisSetProcTitle</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *title)</span> </span>&#123;
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> USE_SETPROCTITLE</span>
    <span class="hljs-keyword">char</span> *server_mode = <span class="hljs-string">&quot;&quot;</span>;
    <span class="hljs-keyword">if</span> (server.cluster_enabled) server_mode = <span class="hljs-string">&quot; [cluster]&quot;</span>;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (server.sentinel_mode) server_mode = <span class="hljs-string">&quot; [sentinel]&quot;</span>;

    setproctitle(<span class="hljs-string">&quot;%s %s:%d%s&quot;</span>,
        title,
        server.bindaddr_count ? server.bindaddr[<span class="hljs-number">0</span>] : <span class="hljs-string">&quot;*&quot;</span>,
        server.port,
        server_mode);
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    UNUSED(title);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
&#125;</code></pre></div><h3 id="åŠ è½½æŒä¹…åŒ–æ•°æ®"><a href="# åŠ è½½æŒä¹…åŒ–æ•°æ®" class="headerlink" title="åŠ è½½æŒä¹…åŒ–æ•°æ®"></a>åŠ è½½æŒä¹…åŒ–æ•°æ®</h3><p>å¦‚æœä¸æ˜¯ä»¥ sentinel æ¨¡å¼å¯åŠ¨çš„ï¼Œé‚£ä¹ˆä¼šåŠ è½½æŒä¹…åŒ–çš„æ•°æ®ï¼Œå¤„ç†å‡½æ•°ä¸º <code>loadDataFromDisk</code>ã€‚</p><p>å¦‚æœå¼€å¯äº† aofï¼Œé‚£ä¹ˆå°±åŠ è½½ aof æ–‡ä»¶ï¼Œå¦åˆ™åŠ è½½ rdb æ–‡ä»¶ã€‚</p><h5 id="loadAppendOnlyFile"><a href="#loadAppendOnlyFile" class="headerlink" title="loadAppendOnlyFile"></a>loadAppendOnlyFile</h5><p>è¯¥å‡½æ•°ç”¨æ¥è®°è½½ aof æ–‡ä»¶ï¼Œä¸»è¦æµç¨‹å°±æ˜¯åˆ›å»ºä¸€ä¸ªä¼ªå®¢æˆ·ç«¯ï¼Œä» aof æ–‡ä»¶ä¸­è§£æå‡ºæ¥å‘½ä»¤ï¼Œè®© server é‡æ–°æ‰§è¡Œä¸€éã€‚</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (buf[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;*&#x27;</span>) <span class="hljs-keyword">goto</span> fmterr;   <span class="hljs-comment">// åˆ¤æ–­åè®®æ˜¯å¦æ­£ç¡®</span>
<span class="hljs-keyword">if</span> (buf[<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;\0&#x27;</span>) <span class="hljs-keyword">goto</span> readerr; <span class="hljs-comment">// åˆ¤æ–­æ•°æ®å®Œæ•´åˆ¤æ–­</span>
argc = atoi(buf+<span class="hljs-number">1</span>);
<span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">goto</span> fmterr;

argv = zmalloc(<span class="hljs-keyword">sizeof</span>(robj*)*argc); <span class="hljs-comment">// argc ä¸ª robj å¯¹è±¡</span>
fakeClient-&gt;argc = argc;
fakeClient-&gt;argv = argv;

<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; argc; j++) &#123;
    <span class="hljs-keyword">if</span> (fgets(buf,<span class="hljs-keyword">sizeof</span>(buf),fp) == <span class="hljs-literal">NULL</span>) &#123; <span class="hljs-comment">// æ¯è¡Œæœ€å¤š 128B</span>
        fakeClient-&gt;argc = j; <span class="hljs-comment">/* Free up to j-1. */</span>
        freeFakeClientArgv(fakeClient);
        <span class="hljs-keyword">goto</span> readerr;
    &#125;
    <span class="hljs-keyword">if</span> (buf[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;$&#x27;</span>) <span class="hljs-keyword">goto</span> fmterr;
    len = strtol(buf+<span class="hljs-number">1</span>,<span class="hljs-literal">NULL</span>,<span class="hljs-number">10</span>); <span class="hljs-comment">// å‘½ä»¤çš„é•¿åº¦</span>
    argsds = sdsnewlen(<span class="hljs-literal">NULL</span>,len);
    <span class="hljs-keyword">if</span> (len &amp;&amp; fread(argsds,len,<span class="hljs-number">1</span>,fp) == <span class="hljs-number">0</span>) &#123;
        sdsfree(argsds);
        fakeClient-&gt;argc = j; <span class="hljs-comment">/* Free up to j-1. */</span>
        freeFakeClientArgv(fakeClient);
        <span class="hljs-keyword">goto</span> readerr;
    &#125;
    argv[j] = createObject(OBJ_STRING,argsds);
    <span class="hljs-keyword">if</span> (fread(buf,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,fp) == <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// \r\n</span>
        fakeClient-&gt;argc = j+<span class="hljs-number">1</span>; <span class="hljs-comment">/* Free up to j. */</span>
        freeFakeClientArgv(fakeClient);
        <span class="hljs-keyword">goto</span> readerr; <span class="hljs-comment">/* discard CRLF */</span>
    &#125;
&#125;

cmd = lookupCommand(argv[<span class="hljs-number">0</span>]-&gt;ptr);
<span class="hljs-keyword">if</span> (!cmd) &#123;
    serverLog(LL_WARNING,<span class="hljs-string">&quot;Unknown command &#x27;%s&#x27; reading the append only file&quot;</span>, (<span class="hljs-keyword">char</span>*)argv[<span class="hljs-number">0</span>]-&gt;ptr);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
&#125;

<span class="hljs-comment">// ç”¨ fakeClient æ‰§è¡Œå‘½ä»¤</span>
cmd-&gt;proc(fakeClient);</code></pre></div><p>ä»¥ä¸Šå‡½æ•°å°±æ˜¯ aof æ–‡ä»¶è§£æè¿‡ç¨‹ã€‚</p><p>é™„ä¸Šä¸€æ®µ redis åè®®æ•°æ®ï¼Œæ–¹ä¾¿åˆ†æå‡½æ•°ã€‚</p><div class="hljs"><pre><code class="hljs c">*<span class="hljs-number">3</span>
$<span class="hljs-number">3</span>
SET
$<span class="hljs-number">2</span>
xx
$<span class="hljs-number">2</span>
yy
*<span class="hljs-number">3</span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼šåœ¨åŠ è½½ aof æ–‡ä»¶è¿‡ç¨‹ä¸­ï¼Œä¼šæš‚æ—¶å…³é—­ aofã€‚</p><h5 id="rdbLoad"><a href="#rdbLoad" class="headerlink" title="rdbLoad"></a>rdbLoad</h5><p>è¯¥å‡½æ•°ç”¨æ¥åŠ è½½ rdb æ–‡ä»¶ã€‚ä¸ aof åŠ è½½ä¸åŒçš„æ˜¯ï¼Œè§£æ rdb æ–‡ä»¶åç›´æ¥æ”¾å…¥å†…å­˜ä¸­ã€‚</p><h3 id="äº‹ä»¶å¾ªç¯åˆå§‹åŒ–"><a href="# äº‹ä»¶å¾ªç¯åˆå§‹åŒ–" class="headerlink" title="äº‹ä»¶å¾ªç¯åˆå§‹åŒ–"></a>äº‹ä»¶å¾ªç¯åˆå§‹åŒ–</h3><div class="hljs"><pre><code class="hljs c"><span class="hljs-comment">// è¿›å…¥äº‹ä»¶å¾ªç¯ä¹‹å‰æ‰§è¡Œ beforeSleep() å‡½æ•°</span>
aeSetBeforeSleepProc(server.el,beforeSleep);
<span class="hljs-comment">// å¼€å§‹äº‹ä»¶å¾ªç¯</span>
aeMain(server.el);
<span class="hljs-comment">// æœåŠ¡å™¨å…³é—­ï¼Œåˆ é™¤äº‹ä»¶å¾ªç¯</span>
aeDeleteEventLoop(server.el);</code></pre></div><h2 id="å°ç»“"><a href="# å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ç”»äº†ä¸€ä¸ªæµç¨‹å›¾ï¼Œå¯ä»¥å¾ˆå¥½çš„ä½“ç°ä»¥ä¸Šæµç¨‹ã€‚<br><img src="http://ww1.sinaimg.cn/large/71ca8e3cly1fxz66ssdg9j209a0pdac8.jpg" srcset="/img/loading.gif" alt="redis server setup"></p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E6%BA%90%E7%A0%81%E7%B3%BB%E5%88%97/">æºç ç³»åˆ—</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/redis/">redis</a></div></div><p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/3800d1bd.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Redis æºç ä¹‹ cluster åˆå§‹åŒ–</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/9ceee0f6.html"><span class="hidden-mobile">Redis æºç ä¹‹ Bio</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjg1MS8xMzM4Nw"><script type="text/javascript">function loadLivere(){addScript("https://cdn-city.livere.com/js/embed.dist.js")}waitElementVisible("lv-container",loadLivere)</script><noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·å…è®¸ JavaScript è¿è¡Œ</noscript></div></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="footer-content"><div><span id="timeDate">è½½å…¥å¤©æ•°...</span> <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span><script>var now=new Date;function createtime(){var n=new Date("04/03/2016 00:00:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="ğŸš€ &nbsp"+dnum+"&nbspå¤©",document.getElementById("times").innerHTML=hnum+"&nbspå°æ—¶&nbsp"+mnum+"&nbspåˆ†&nbsp"+snum+"&nbspç§’"}setInterval("createtime()",250)</script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span> æ¬¡ </span><span id="busuanzi_container_site_uv" style="display:none">æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv"></span> äºº</span></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:"#post-body",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:3,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","Redis æºç ä¹‹å¯åŠ¨æµç¨‹&nbsp;"],cursorChar:"|",typeSpeed:72,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "Â§"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?14630c2a053c5952e46094f24dabb623";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>